# ClassEcon Authentication Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ClassEcon Platform                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Frontend   â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚   Backend    â”‚â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ Auth Service â”‚       â”‚
â”‚  â”‚  (React)    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”‚  (GraphQL)   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”‚  (Express)   â”‚       â”‚
â”‚  â”‚  Port 5173  â”‚        â”‚  Port 4000   â”‚        â”‚  Port 4001   â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚         â”‚                       â”‚                        â”‚               â”‚
â”‚         â”‚                       â”‚                        â”‚               â”‚
â”‚         â–¼                       â–¼                        â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  ModernAuth â”‚        â”‚   MongoDB    â”‚        â”‚ JWT Tokens   â”‚       â”‚
â”‚  â”‚  Component  â”‚        â”‚  Database    â”‚        â”‚   bcrypt     â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

External OAuth Providers:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Google    â”‚                  â”‚  Microsoft   â”‚
â”‚   OAuth 2.0  â”‚                  â”‚   OAuth 2.0  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Authentication Flows

### 1. Traditional Email/Password Login

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User   â”‚         â”‚ Frontend â”‚         â”‚ Backend  â”‚         â”‚   Auth   â”‚
â”‚        â”‚         â”‚          â”‚         â”‚          â”‚         â”‚ Service  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚ Enter email/pass  â”‚                    â”‚                     â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚ login(email, pwd)  â”‚                     â”‚
    â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚ verifyPassword()    â”‚
    â”‚                   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚ {isValid: true}     â”‚
    â”‚                   â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚ signTokens()        â”‚
    â”‚                   â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚ {access, refresh}   â”‚
    â”‚                   â”‚                    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚                   â”‚ {user, accessToken}â”‚                     â”‚
    â”‚                   â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                     â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚  Login Success    â”‚                    â”‚                     â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚                     â”‚
    â”‚  Redirect to /    â”‚                    â”‚                     â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                     â”‚
    â”‚                   â”‚                    â”‚                     â”‚
```

### 2. OAuth Sign-In (Google/Microsoft)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User   â”‚    â”‚ Frontend â”‚    â”‚ Provider â”‚    â”‚ Backend  â”‚    â”‚   Auth   â”‚
â”‚        â”‚    â”‚          â”‚    â”‚  (OAuth) â”‚    â”‚          â”‚    â”‚ Service  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚ Click OAuth  â”‚               â”‚               â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚ Redirect to   â”‚               â”‚               â”‚
    â”‚              â”‚ OAuth consent â”‚               â”‚               â”‚
    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚  Login with  â”‚               â”‚               â”‚               â”‚
    â”‚  Provider    â”‚               â”‚               â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚ Grant perms   â”‚               â”‚               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚ Redirect with â”‚               â”‚               â”‚
    â”‚              â”‚ auth code     â”‚               â”‚               â”‚
    â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚ oauthLogin(   â”‚               â”‚               â”‚
    â”‚              â”‚   provider,   â”‚               â”‚               â”‚
    â”‚              â”‚   code)       â”‚               â”‚               â”‚
    â”‚              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚ POST /oauth/  â”‚
    â”‚              â”‚               â”‚               â”‚ {provider}    â”‚
    â”‚              â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚ Exchange
    â”‚              â”‚               â”‚               â”‚               â”‚ code for
    â”‚              â”‚               â”‚               â”‚ GET user info â”‚ token
    â”‚              â”‚               â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚              â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚ User info     â”‚               â”‚
    â”‚              â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚  Create/Find  â”‚               â”‚
    â”‚              â”‚               â”‚  User in DB   â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚ signTokens()  â”‚
    â”‚              â”‚               â”‚               â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚ JWT tokens    â”‚
    â”‚              â”‚               â”‚               â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚              â”‚ {user, token} â”‚               â”‚               â”‚
    â”‚              â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
    â”‚  Login Success & Redirect    â”‚               â”‚               â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚               â”‚               â”‚
    â”‚              â”‚               â”‚               â”‚               â”‚
```

---

## Component Architecture

### Frontend Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  main.tsx                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         React Router Routes              â”‚  â”‚
â”‚  â”‚                                           â”‚  â”‚
â”‚  â”‚  /auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ ModernAuth            â”‚  â”‚
â”‚  â”‚  /auth/callback/google â”€â”€â–¶ OAuthCallback â”‚  â”‚
â”‚  â”‚  /auth/callback/microsoft â–¶ OAuthCallbackâ”‚  â”‚
â”‚  â”‚  / â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Dashboard (Protected) â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ModernAuth Component Structure:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ModernAuth.tsx                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Tabs (Login / Signup)            â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Login      â”‚   Signup     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚              â”‚              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Email      â”‚ â€¢ Name       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ Password   â”‚ â€¢ Email      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ â€¢ ğŸ‘ Toggle  â”‚ â€¢ Password   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚              â”‚ â€¢ ğŸ‘ Toggle  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚              â”‚ â€¢ Role       â”‚  â”‚  â”‚
â”‚  â”‚  â”‚              â”‚ â€¢ Join Code  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚              â”‚              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ [LoginBtn]   â”‚ [Sign Up]    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚   OAuth Providers            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  [ğŸ”µ Google]  [ğŸ”· Microsoft] â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Backend Services

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Backend GraphQL Server                â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           GraphQL Schema                     â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚  type Mutation {                             â”‚ â”‚
â”‚  â”‚    login(email, password): AuthPayload       â”‚ â”‚
â”‚  â”‚    signUp(input): AuthPayload                â”‚ â”‚
â”‚  â”‚    oauthLogin(provider, code): AuthPayload   â”‚ â”‚
â”‚  â”‚    refreshAccessToken: String                â”‚ â”‚
â”‚  â”‚    logout: Boolean                           â”‚ â”‚
â”‚  â”‚  }                                           â”‚ â”‚
â”‚  â”‚                                              â”‚ â”‚
â”‚  â”‚  type User {                                 â”‚ â”‚
â”‚  â”‚    id, email, name, role                    â”‚ â”‚
â”‚  â”‚    oauthProvider, oauthProviderId           â”‚ â”‚
â”‚  â”‚    profilePicture                           â”‚ â”‚
â”‚  â”‚  }                                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             Resolvers                        â”‚ â”‚
â”‚  â”‚  â€¢ Mutation.login()                          â”‚ â”‚
â”‚  â”‚  â€¢ Mutation.signUp()                         â”‚ â”‚
â”‚  â”‚  â€¢ Mutation.oauthLogin() â”€â”€â”€â”€â”€â–¶ Auth Serviceâ”‚ â”‚
â”‚  â”‚  â€¢ Mutation.logout()                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         AuthServiceClient                    â”‚ â”‚
â”‚  â”‚  â€¢ hashPassword()                            â”‚ â”‚
â”‚  â”‚  â€¢ verifyPassword()                          â”‚ â”‚
â”‚  â”‚  â€¢ signTokens()                              â”‚ â”‚
â”‚  â”‚  â€¢ verifyAccessToken()                       â”‚ â”‚
â”‚  â”‚  â€¢ request() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ HTTP to Auth   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Auth Service (Express)                â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚             REST Endpoints                   â”‚ â”‚
â”‚  â”‚  POST /hash-password                         â”‚ â”‚
â”‚  â”‚  POST /verify-password                       â”‚ â”‚
â”‚  â”‚  POST /sign-tokens                           â”‚ â”‚
â”‚  â”‚  POST /verify-access-token                   â”‚ â”‚
â”‚  â”‚  POST /verify-refresh-token                  â”‚ â”‚
â”‚  â”‚  POST /refresh                               â”‚ â”‚
â”‚  â”‚  POST /logout                                â”‚ â”‚
â”‚  â”‚  POST /oauth/google â”€â”€â”€â”€â–¶ OAuthService       â”‚ â”‚
â”‚  â”‚  POST /oauth/microsoft â”€â–¶ OAuthService       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          OAuthService                        â”‚ â”‚
â”‚  â”‚  â€¢ handleGoogleCallback()                    â”‚ â”‚
â”‚  â”‚    - Exchange code for token                 â”‚ â”‚
â”‚  â”‚    - Fetch user info                         â”‚ â”‚
â”‚  â”‚  â€¢ handleMicrosoftCallback()                 â”‚ â”‚
â”‚  â”‚    - Exchange code for token                 â”‚ â”‚
â”‚  â”‚    - Fetch user info                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚          Core Auth Functions                 â”‚ â”‚
â”‚  â”‚  â€¢ hashPassword (bcrypt)                     â”‚ â”‚
â”‚  â”‚  â€¢ verifyPassword (bcrypt)                   â”‚ â”‚
â”‚  â”‚  â€¢ signAccessToken (JWT 15min)               â”‚ â”‚
â”‚  â”‚  â€¢ signRefreshToken (JWT 7days)              â”‚ â”‚
â”‚  â”‚  â€¢ verifyAccessToken (JWT)                   â”‚ â”‚
â”‚  â”‚  â€¢ verifyRefreshToken (JWT)                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

### User Model (MongoDB)

```javascript
{
  _id: ObjectId,
  email: String (unique, sparse index),
  name: String (required),
  role: "TEACHER" | "STUDENT" | "PARENT" (required),
  status: "ACTIVE" | "INVITED" | "DISABLED",
  
  // Traditional auth
  passwordHash: String (nullable for OAuth users),
  
  // OAuth integration
  oauthProvider: "google" | "microsoft" | null,
  oauthProviderId: String (provider's user ID),
  profilePicture: String (URL from OAuth provider),
  
  // Timestamps
  createdAt: DateTime,
  updatedAt: DateTime
}
```

### Example Documents

**Traditional User:**
```json
{
  "_id": "507f1f77bcf86cd799439011",
  "email": "teacher@school.com",
  "name": "John Teacher",
  "role": "TEACHER",
  "status": "ACTIVE",
  "passwordHash": "$2a$12$xyz...",
  "oauthProvider": null,
  "oauthProviderId": null,
  "profilePicture": null
}
```

**OAuth User (Google):**
```json
{
  "_id": "507f1f77bcf86cd799439022",
  "email": "student@gmail.com",
  "name": "Jane Student",
  "role": "STUDENT",
  "status": "ACTIVE",
  "passwordHash": null,
  "oauthProvider": "google",
  "oauthProviderId": "google_123456789",
  "profilePicture": "https://lh3.googleusercontent.com/a/..."
}
```

**Hybrid User (Has Both):**
```json
{
  "_id": "507f1f77bcf86cd799439033",
  "email": "parent@outlook.com",
  "name": "Bob Parent",
  "role": "PARENT",
  "status": "ACTIVE",
  "passwordHash": "$2a$12$abc...",
  "oauthProvider": "microsoft",
  "oauthProviderId": "microsoft_987654321",
  "profilePicture": "https://graph.microsoft.com/..."
}
```

---

## Security Architecture

### Token Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  JWT Token System                    â”‚
â”‚                                                      â”‚
â”‚  Access Token (15 minutes)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Header: { "alg": "HS256", "typ": "JWT" }      â”‚ â”‚
â”‚  â”‚  Payload: {                                    â”‚ â”‚
â”‚  â”‚    "sub": "userId",                            â”‚ â”‚
â”‚  â”‚    "role": "TEACHER",                          â”‚ â”‚
â”‚  â”‚    "iat": 1234567890,                          â”‚ â”‚
â”‚  â”‚    "exp": 1234568790                           â”‚ â”‚
â”‚  â”‚  }                                             â”‚ â”‚
â”‚  â”‚  Signature: HMACSHA256(header.payload, secret)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚  Refresh Token (7 days)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Header: { "alg": "HS256", "typ": "JWT" }      â”‚ â”‚
â”‚  â”‚  Payload: {                                    â”‚ â”‚
â”‚  â”‚    "sub": "userId",                            â”‚ â”‚
â”‚  â”‚    "role": "TEACHER",                          â”‚ â”‚
â”‚  â”‚    "iat": 1234567890,                          â”‚ â”‚
â”‚  â”‚    "exp": 1235172690                           â”‚ â”‚
â”‚  â”‚  }                                             â”‚ â”‚
â”‚  â”‚  Signature: HMACSHA256(header.payload, secret)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                      â”‚
â”‚  Storage:                                           â”‚
â”‚  â€¢ Access Token: localStorage + Redux state         â”‚
â”‚  â€¢ Refresh Token: HTTP-only cookie                 â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service-to-Service Authentication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Backend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ Auth Service        â”‚
â”‚                                                 â”‚
â”‚  Request Headers:                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Content-Type: application/json           â”‚ â”‚
â”‚  â”‚  x-service-api-key: <32-byte-hex-key>     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                 â”‚
â”‚  Environment Variables:                         â”‚
â”‚  â€¢ Backend/.env: SERVICE_API_KEY=abc123...     â”‚
â”‚  â€¢ AuthService/.env: SERVICE_API_KEY=abc123... â”‚
â”‚  (Must match!)                                  â”‚
â”‚                                                 â”‚
â”‚  Middleware Protection:                         â”‚
â”‚  â€¢ validateServiceApiKey() on all protected    â”‚
â”‚    endpoints                                    â”‚
â”‚  â€¢ Rejects requests with invalid/missing key   â”‚
â”‚                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Environment Variables

### Auth Service (.env)
```env
PORT=4001
JWT_SECRET=<32-byte-hex>
REFRESH_JWT_SECRET=<32-byte-hex>
SERVICE_API_KEY=<32-byte-hex>

# OAuth (Optional)
GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=xxx
GOOGLE_REDIRECT_URI=http://localhost:5173/auth/callback/google

MICROSOFT_CLIENT_ID=xxx
MICROSOFT_CLIENT_SECRET=xxx
MICROSOFT_REDIRECT_URI=http://localhost:5173/auth/callback/microsoft
```

### Backend (.env)
```env
MONGODB_URI=mongodb://localhost:27017/classecon
AUTH_SERVICE_URL=http://localhost:4001
SERVICE_API_KEY=<same-as-auth-service>
```

### Frontend (.env)
```env
VITE_GRAPHQL_URL=http://localhost:4000/graphql
VITE_AUTH_SERVICE_URL=http://localhost:4001

# OAuth Client IDs (NOT secrets!)
VITE_GOOGLE_CLIENT_ID=xxx.apps.googleusercontent.com
VITE_MICROSOFT_CLIENT_ID=xxx
```

---

## API Reference

### Auth Service REST API

```
GET  /health
  Response: { status: "ok", service: "auth-service" }

POST /hash-password
  Headers: x-service-api-key
  Body: { password: string }
  Response: { hash: string }

POST /verify-password
  Headers: x-service-api-key
  Body: { password: string, hash: string }
  Response: { isValid: boolean }

POST /sign-tokens
  Headers: x-service-api-key
  Body: { userId: string, role: string }
  Response: { accessToken: string, refreshToken: string }

POST /verify-access-token
  Headers: x-service-api-key
  Body: { token: string }
  Response: { payload: { sub, role, iat, exp } }

POST /oauth/google
  Headers: x-service-api-key
  Body: { code: string }
  Response: { userInfo: { id, email, name, picture, provider } }

POST /oauth/microsoft
  Headers: x-service-api-key
  Body: { code: string }
  Response: { userInfo: { id, email, name, provider } }
```

### Backend GraphQL API

```graphql
type Mutation {
  login(email: String!, password: String!): AuthPayload!
  signUp(input: SignUpInput!): AuthPayload!
  oauthLogin(provider: OAuthProvider!, code: String!): AuthPayload!
  refreshAccessToken: String!
  logout: Boolean!
}

type AuthPayload {
  user: User!
  accessToken: String!
}

enum OAuthProvider {
  GOOGLE
  MICROSOFT
}
```

---

This architecture provides:
- âœ… Clear separation of concerns
- âœ… Secure microservice communication
- âœ… Scalable OAuth integration
- âœ… Modern UX with multiple auth methods
- âœ… Production-ready security patterns
